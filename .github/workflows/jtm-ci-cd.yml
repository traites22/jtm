name: JTM CI/CD

on:
  push:
    branches: [main, develop]
  jobs:
    test:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v3
        - uses: actions/setup-java@v3
        - uses: actions/setup-flutter@v3
        - run: flutter test
        - run: flutter analyze
    build:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v3
        - uses: actions/setup-java@v3
        - uses: actions/setup-flutter@v3
        - run: flutter build web --release
        - run: flutter build apk --release
    deploy:
      runs-on: ubuntu-latest
      needs: build
      steps:
        - uses: actions/checkout@v3
        - uses: actions/setup-java@v3
        - uses: actions/setup-flutter@v3
        - name: Deploy to Firebase Hosting
        run: |
          firebase deploy --only functions --project jtm-prod
          firebase deploy --only hosting --project jtm-prod
